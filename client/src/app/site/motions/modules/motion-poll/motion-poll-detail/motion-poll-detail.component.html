<os-head-bar
    [goBack]="true"
    [nav]="false"
    [hasMainButton]="poll ? poll.state === 2 || poll.state === 3 : false"
    [mainButtonIcon]="'bar_chart'"
    [mainActionTooltip]="'Enter votes' | translate"
    (mainEvent)="enterVote()"
>
    <div class="title-slot">
        <h2 *ngIf="!!poll">{{ poll.title }}</h2>
    </div>

    <div class="menu-slot" *osPerms="'agenda.can_manage'; or: 'agenda.can_see_list_of_speakers'">
        <button type="button" mat-icon-button [matMenuTriggerFor]="pollDetailMenu">
            <mat-icon>more_vert</mat-icon>
        </button>
    </div>
</os-head-bar>

<mat-card class="os-card">
    <ng-container [ngTemplateOutlet]="viewTemplate"></ng-container>
</mat-card>

<!-- Detailview for poll -->
<ng-template #viewTemplate>
    <ng-container *ngIf="poll">
        <h1>{{ poll.title }}</h1>
        <mat-divider></mat-divider>
        <os-breadcrumb [breadcrumbs]="breadcrumbs" [breadcrumbStyle]="'>'"></os-breadcrumb>
        <div class="poll-content">
            <div>{{ 'Current state' | translate }}: {{ poll.stateVerbose | translate }}</div>
            <div *ngIf="poll.groups && poll.type && poll.type !== 'analog'">
                {{ 'Groups' | translate }}:
                <span *ngFor="let group of poll.groups">{{ group.getTitle() | translate }}</span>
            </div>
            <div>{{ 'Poll type' | translate }}: {{ poll.typeVerbose | translate }}</div>
            <div>{{ 'Poll method' | translate }}: {{ poll.pollmethodVerbose | translate }}</div>
            <div>{{ 'Majority method' | translate }}: {{ poll.majorityMethodVerbose | translate }}</div>
            <div>{{ '100% base' | translate }}: {{ poll.percentBaseVerbose | translate }}</div>
        </div>

        <div *ngIf="poll.state === 3 || poll.state === 4">
            <h2 translate>Result</h2>
            <div class="chart-wrapper">
                <mat-form-field>
                    <mat-select [(ngModel)]="chartType" [placeholder]="'Display as' | translate">
                        <mat-option [value]="'horizontalBar'">{{ 'Bar' | translate }}</mat-option>
                        <mat-option [value]="'doughnut'">{{ 'Circle' | translate }}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <os-charts [type]="chartType" [labels]="labels" [showLegend]="true" [data]="chartDataSubject"></os-charts>
        </div>
    </ng-container>
</ng-template>

<!-- More Menu -->
<mat-menu #pollDetailMenu="matMenu">
    <os-projector-button [menuItem]="true" [object]="poll" *osPerms="'core.can_manage_projector'"></os-projector-button>
    <mat-divider></mat-divider>
    <button mat-menu-item (click)="deletePoll()"><mat-icon>delete</mat-icon><span translate>Delete</span></button>
</mat-menu>
